<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestão de Alunos - EscolaSystem</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #2a9d8f;
      /* Um verde mais vibrante */
      --secondary-color: #e9c46a;
      /* Um amarelo-mostarda */
      --dark-blue: #264653;
      /* Azul escuro da sua th */
      --light-grey: #f8f9fa;
      --border-color: #dee2e6;
      --text-muted: #6c757d;
    }

    body {
      background-color: var(--light-grey);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .sidebar {
      height: 100vh;
      background-color: #fff;
      border-right: 1px solid var(--border-color);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
    }

    .sidebar .nav-link {
      color: var(--dark-blue);
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      transition: background-color 0.2s ease, color 0.2s ease;
    }

    .sidebar .nav-link:hover {
      background-color: #f0f2f5;
      color: var(--primary-color);
    }

    .sidebar .nav-link.active {
      background-color: var(--primary-color);
      color: #fff;
      font-weight: 600;
    }

    .sidebar .nav-link.active:hover {
      background-color: var(--primary-color);
      color: #fff;
    }

    .sidebar h5 {
      color: var(--dark-blue);
      font-weight: 700;
      margin-bottom: 2rem;
    }

    .sidebar .text-muted.small {
      font-size: 0.8rem;
      margin-bottom: 1rem;
      color: var(--text-muted) !important;
    }

    .sidebar .mt-5 {
      margin-top: auto !important;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .badge-status {
      background-color: #d1e7dd;
      color: #0f5132;
      padding: 0.4em 0.7em;
      border-radius: 0.5rem;
      font-weight: 600;
      font-size: 0.75em;
    }

    .badge-status.inativo {
      /* Classe para status "Inativo" */
      background-color: #f8d7da;
      color: #842029;
    }

    .card-counter {
      border: none;
      border-radius: 0.75rem;
      padding: 1.2rem;
      background-color: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.2s ease;
    }

    .card-counter:hover {
      transform: translateY(-3px);
    }

    .card-counter .text-muted.small {
      font-size: 0.85rem;
      color: var(--text-muted) !important;
    }

    .card-counter .fs-4 {
      font-size: 1.8rem !important;
      color: var(--dark-blue);
    }

    .icon-action {
      color: var(--dark-blue);
      cursor: pointer;
      margin-right: 0.5rem;
      transition: color 0.2s ease;
    }

    .icon-action:hover {
      color: var(--primary-color);
    }

    .icon-action.delete:hover {
      color: #dc3545;
    }

    .table td,
    .table th {
      vertical-align: middle;
      padding: 1rem 0.75rem;
    }

    .table thead th {
      background-color: var(--dark-blue) !important;
      color: white !important;
      font-weight: 600;
    }

    .table tbody tr:hover {
      background-color: #f0f2f5;
    }

    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      font-weight: 500;
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      transition: all 0.2s ease;
    }

    .btn-primary:hover {
      background-color: #23867b;
      border-color: #23867b;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-select-sm,
    .form-control-sm {
      border-radius: 0.5rem;
      border-color: var(--border-color);
    }

    .form-select-sm:focus,
    .form-control-sm:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(42, 157, 143, 0.25);
    }

    .modal-header {
      background-color: var(--dark-blue);
      color: white;
      border-bottom: none;
      border-top-left-radius: 0.75rem;
      border-top-right-radius: 0.75rem;
    }

    .modal-title {
      font-weight: 600;
    }

    .modal-content {
      border-radius: 0.75rem;
      overflow: hidden;
    }

    .modal-footer {
      border-top: 1px solid var(--border-color);
    }

    .btn-outline-secondary {
      border-color: var(--border-color);
      color: var(--text-muted);
    }

    .btn-outline-secondary:hover {
      background-color: #e9ecef;
      color: #495057;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 sidebar d-none d-md-flex flex-column p-3">
        <h5 class="mb-4">EscolaSystem</h5>
        <p class="text-muted small">Gestão Acadêmica</p>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="bi bi-speedometer2 me-2"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="alunos.html">
              <i class="bi bi-person-fill me-2"></i>Alunos
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="turmas.html">
              <i class="bi bi-people-fill me-2"></i>Turmas
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="frequencia.html">
              <i class="bi bi-check2-square me-2"></i>Frequência
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="relatorios.html">
              <i class="bi bi-bar-chart-line-fill me-2"></i>Relatórios
            </a>
          </li>
          <li>
            <a href="usuarios.html" class="nav-link">
              <i class="bi bi-people"></i> Gerenciar Usuários
            </a>
          </li>
        </ul>
        <div class="mt-5">
          <small class="text-muted">Usuário Logado</small>
          <div class="fw-bold">Professor</div>
          <div class="text-muted small">professor@gmail.com</div>
          <span class="badge bg-dark mt-2">Professor</span>
        </div>
        <button class="btn btn-outline-secondary btn-sm mt-4">
          <i class="bi bi-box-arrow-right me-1"></i>Sair do Sistema
        </button>
      </nav>

      <main class="col-md-10 p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h3>Gestão de Alunos</h3>
            <p class="text-muted">
              Gerencie as matrículas e informações dos estudantes.
            </p>
          </div>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newStudentModal">
            <i class="bi bi-person-plus-fill me-2"></i>Nova Matrícula
          </button>
        </div>

        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="card-counter">
              <div class="text-muted small">Total de Alunos</div>
              <div class="fs-4 fw-bold" id="totalAlunosCount">0</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-counter">
              <div class="text-muted small">Alunos Ativos</div>
              <div class="fs-4 fw-bold" id="alunosAtivosCount">0</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-counter">
              <div class="text-muted small">Resultados Filtrados</div>
              <div class="fs-4 fw-bold" id="filteredCount">0</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-counter">
              <div class="text-muted small">Turmas Ativas</div>
              <div class="fs-4 fw-bold" id="turmasAtivasCount">3</div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex gap-2">
            <select class="form-select form-select-sm" id="statusFilter" style="width: 150px">
              <option value="">Todos os Status</option>
              <option value="Ativo">Ativo</option>
              <option value="Inativo">Inativo</option>
            </select>
            <select class="form-select form-select-sm" id="turmaFilter" style="width: 200px">
              <option value="">Todas as Turmas</option>
            </select>
          </div>
          <input type="text" id="searchInput" class="form-control form-control-sm"
            placeholder="Buscar por nome, CPF ou matrícula..." style="width: 300px" />
        </div>

        <div class="table-responsive">
          <table class="table table-bordered table-hover bg-white shadow-sm" id="alunoTable">
            <thead class="table-light">
              <tr>
                <th>Nome</th>
                <th>Matrícula</th>
                <th>CPF</th>
                <th>Turma</th>
                <th>Status</th>
                <th>Data Nascimento</th>
                <th style="width: 120px">Ações</th>
              </tr>
            </thead>
            <tbody id="alunoBody">
            </tbody>
          </table>
        </div>

        <div id="noResultsMessage" class="alert alert-info text-center mt-3 d-none" role="alert">
          Nenhum aluno encontrado com os filtros aplicados.
        </div>

      </main>
    </div>
  </div>

  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Aluno</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editForm">
            <input type="hidden" id="editAlunoId" />
            <div class="mb-3">
              <label for="editNome" class="form-label">Nome</label>
              <input type="text" class="form-control" id="editNome" required />
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editEmail" required />
            </div>
            <div class="mb-3">
              <label for="editCPF" class="form-label">CPF</label>
              <input type="text" class="form-control" id="editCPF" required />
            </div>
            <div class="mb-3">
              <label for="editMatricula" class="form-label">Matrícula</label>
              <input type="text" class="form-control" id="editMatricula" required readonly />
            </div>
            <div class="mb-3">
              <label for="editTurma" class="form-label">Turma</label>
              <select class="form-select" id="editTurma" required>
              </select>
            </div>
            <div class="mb-3">
              <label for="editNascimento" class="form-label">Data Nascimento</label>
              <input type="date" class="form-control" id="editNascimento" required />
            </div>
            <div class="mb-3">
              <label for="editStatus" class="form-label">Status</label>
              <select class="form-select" id="editStatus" required>
                <option value="Ativo">Ativo</option>
                <option value="Inativo">Inativo</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">
            Cancelar
          </button>
          <button class="btn btn-primary" onclick="saveEdit()">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="newStudentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Cadastrar Novo Aluno</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="newStudentForm">
            <div class="mb-3">
              <label for="newNome" class="form-label">Nome Completo</label>
              <input type="text" class="form-control" id="newNome" required>
            </div>
            <div class="mb-3">
              <label for="newEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="newEmail" required>
            </div>
            <div class="mb-3">
              <label for="newCPF" class="form-label">CPF</label>
              <input type="text" class="form-control" id="newCPF" required>
            </div>
            <div class="mb-3">
              <label for="newNascimento" class="form-label">Data de Nascimento</label>
              <input type="date" class="form-control" id="newNascimento" required>
            </div>
            <div class="mb-3">
              <label for="newTurma" class="form-label">Turma</label>
              <select class="form-select" id="newTurma" required>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="addNewStudent()">Cadastrar Aluno</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // --- Dados Mockados (Simulação de Backend) ---
    let alunos = [
      {
        id: 'a1',
        nome: "Ana Silva Santos",
        email: "ana.santos@email.com",
        matricula: "20240001",
        cpf: "123.456.789-01",
        turmaId: "t1", // Referência ao ID da turma
        status: "Ativo",
        nascimento: "2010-03-14", // Formato YYYY-MM-DD para input date
      },
      {
        id: 'a2',
        nome: "João Pedro Oliveira",
        email: "joao.oliveira@email.com",
        matricula: "20240002",
        cpf: "987.654.321-00",
        turmaId: "t1",
        status: "Ativo",
        nascimento: "2009-07-21",
      },
      {
        id: 'a3',
        nome: "Beatriz Costa Lima",
        email: "beatriz.lima@email.com",
        matricula: "20240003",
        cpf: "111.222.333-44",
        turmaId: "t2",
        status: "Ativo",
        nascimento: "2008-12-07",
      },
      {
        id: 'a4',
        nome: "Gabriel Ferreira Souza",
        email: "gabriel.souza@email.com",
        matricula: "20240004",
        cpf: "555.666.777-88",
        turmaId: "t3",
        status: "Ativo",
        nascimento: "2010-01-29",
      },
      {
        id: 'a5',
        nome: "Larissa Mendes Ribeiro",
        email: "larissa.ribeiro@email.com",
        matricula: "20240005",
        cpf: "333.444.555-66",
        turmaId: "t2",
        status: "Inativo", // Aluno inativo para teste
        nascimento: "2009-09-13",
      },
    ];

    let turmas = [
      { id: 't1', nome: "Turma A", serie: "1º Ano" },
      { id: 't2', nome: "Turma A", serie: "2º Ano" },
      { id: 't3', nome: "Turma B", serie: "1º Ano" },
    ];

    let currentEditAlunoId = null;

    // --- Funções de Ajuda ---
    function formatDateToDisplay(dateString) {
      if (!dateString) return '';
      const [year, month, day] = dateString.split('-');
      return `${day}/${month}/${year}`;
    }

    function getTurmaNome(turmaId) {
      const turma = turmas.find(t => t.id === turmaId);
      return turma ? `${turma.nome} - ${turma.serie}` : 'N/A';
    }

    function populateTurmaSelects() {
      const turmaFilterSelect = document.getElementById('turmaFilter');
      const editTurmaSelect = document.getElementById('editTurma');
      const newTurmaSelect = document.getElementById('newTurma');

      // Limpa opções existentes, exceto a primeira "Todas as Turmas"
      turmaFilterSelect.innerHTML = '<option value="">Todas as Turmas</option>';
      editTurmaSelect.innerHTML = '';
      newTurmaSelect.innerHTML = '';

      turmas.forEach(turma => {
        const optionText = `${turma.nome} - ${turma.serie}`;
        const optionValue = turma.id;

        // Para filtro
        const filterOption = document.createElement('option');
        filterOption.value = optionValue;
        filterOption.textContent = optionText;
        turmaFilterSelect.appendChild(filterOption);

        // Para edição
        const editOption = document.createElement('option');
        editOption.value = optionValue;
        editOption.textContent = optionText;
        editTurmaSelect.appendChild(editOption);

        // Para nova matrícula
        const newOption = document.createElement('option');
        newOption.value = optionValue;
        newOption.textContent = optionText;
        newTurmaSelect.appendChild(newOption);
      });
    }

    // --- Funções Principais ---
    async function fetchAlunos() {
      // Simula uma chamada de API para obter alunos
      await new Promise(resolve => setTimeout(resolve, 500)); // Simula latência
      // Em um ambiente real: const response = await fetch('/api/alunos'); const data = await response.json(); alunos = data;
      renderTable();
      updateCounts();
    }

    function renderTable() {
      const tbody = document.getElementById("alunoBody");
      const search = document.getElementById("searchInput").value.toLowerCase();
      const turmaFilterId = document.getElementById("turmaFilter").value;
      const status = document.getElementById("statusFilter").value;
      tbody.innerHTML = "";

      let filtered = alunos.filter((a) => {
        const matchesSearch =
          a.nome.toLowerCase().includes(search) ||
          a.email.toLowerCase().includes(search) ||
          a.cpf.includes(search) ||
          a.matricula.includes(search);

        const matchesTurma = !turmaFilterId || a.turmaId === turmaFilterId;
        const matchesStatus = !status || a.status === status;

        return matchesSearch && matchesTurma && matchesStatus;
      });

      if (filtered.length === 0) {
        document.getElementById('noResultsMessage').classList.remove('d-none');
      } else {
        document.getElementById('noResultsMessage').classList.add('d-none');
        filtered.forEach((a) => {
          let row = `
                    <tr>
                        <td>${a.nome}<br><small class="text-muted">${a.email}</small></td>
                        <td>${a.matricula}</td>
                        <td>${a.cpf}</td>
                        <td>${getTurmaNome(a.turmaId)}</td>
                        <td><span class="badge-status ${a.status.toLowerCase()}">${a.status}</span></td>
                        <td>${formatDateToDisplay(a.nascimento)}</td>
                        <td>
                            <i class="bi bi-pencil-fill icon-action" onclick="openEditModal('${a.id}')" title="Editar"></i>
                            <i class="bi bi-trash-fill icon-action delete" onclick="confirmDelete('${a.id}', '${a.nome}')" title="Excluir"></i>
                        </td>
                    </tr>`;
          tbody.innerHTML += row;
        });
      }
      document.getElementById("filteredCount").innerText = filtered.length;
    }

    function updateCounts() {
      document.getElementById("totalAlunosCount").innerText = alunos.length;
      const alunosAtivos = alunos.filter(a => a.status === 'Ativo').length;
      document.getElementById("alunosAtivosCount").innerText = alunosAtivos;
    }

    async function openEditModal(alunoId) {
      currentEditAlunoId = alunoId;
      const aluno = alunos.find(a => a.id === alunoId);
      if (aluno) {
        document.getElementById("editAlunoId").value = aluno.id;
        document.getElementById("editNome").value = aluno.nome;
        document.getElementById("editEmail").value = aluno.email;
        document.getElementById("editCPF").value = aluno.cpf;
        document.getElementById("editMatricula").value = aluno.matricula;
        document.getElementById("editTurma").value = aluno.turmaId;
        document.getElementById("editNascimento").value = aluno.nascimento;
        document.getElementById("editStatus").value = aluno.status;

        const modal = new bootstrap.Modal(document.getElementById("editModal"));
        modal.show();
      }
    }

    async function saveEdit() {
      const alunoId = document.getElementById("editAlunoId").value;
      const nome = document.getElementById("editNome").value;
      const email = document.getElementById("editEmail").value;
      const cpf = document.getElementById("editCPF").value;
      const matricula = document.getElementById("editMatricula").value;
      const turmaId = document.getElementById("editTurma").value;
      const nascimento = document.getElementById("editNascimento").value;
      const status = document.getElementById("editStatus").value;

      // Simulação de chamada de API para atualizar aluno
      await new Promise(resolve => setTimeout(resolve, 500)); // Simula latência

      const alunoIndex = alunos.findIndex(a => a.id === alunoId);
      if (alunoIndex !== -1) {
        alunos[alunoIndex] = {
          ...alunos[alunoIndex], // Mantém outras propriedades
          nome, email, cpf, matricula, turmaId, nascimento, status
        };
        renderTable();
        updateCounts();
        bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
        alert('Aluno atualizado com sucesso!'); // Feedback visual
      } else {
        alert('Erro: Aluno não encontrado.');
      }
    }

    async function addNewStudent() {
      const newNome = document.getElementById('newNome').value;
      const newEmail = document.getElementById('newEmail').value;
      const newCPF = document.getElementById('newCPF').value;
      const newNascimento = document.getElementById('newNascimento').value;
      const newTurmaId = document.getElementById('newTurma').value;

      if (!newNome || !newEmail || !newCPF || !newNascimento || !newTurmaId) {
        alert('Por favor, preencha todos os campos para cadastrar o aluno.');
        return;
      }

      // Simulação de chamada de API para adicionar aluno
      await new Promise(resolve => setTimeout(resolve, 700)); // Simula latência

      const newId = 'a' + (alunos.length + 1); // Gerar ID simples para simulação
      const newMatricula = '2024' + String(alunos.length + 1).padStart(4, '0');

      const novoAluno = {
        id: newId,
        nome: newNome,
        email: newEmail,
        matricula: newMatricula,
        cpf: newCPF,
        turmaId: newTurmaId,
        status: 'Ativo', // Novo aluno é sempre ativo
        nascimento: newNascimento
      };

      alunos.push(novoAluno);
      renderTable();
      updateCounts();
      document.getElementById('newStudentForm').reset(); // Limpa o formulário
      bootstrap.Modal.getInstance(document.getElementById("newStudentModal")).hide();
      alert('Aluno cadastrado com sucesso!');
    }

    function confirmDelete(alunoId, alunoNome) {
      if (confirm(`Tem certeza que deseja excluir o aluno ${alunoNome}? Esta ação é irreversível.`)) {
        deleteAluno(alunoId);
      }
    }

    async function deleteAluno(alunoId) {
      // Simula chamada de API para deletar aluno
      await new Promise(resolve => setTimeout(resolve, 500)); // Simula latência

      const initialLength = alunos.length;
      alunos = alunos.filter(a => a.id !== alunoId);

      if (alunos.length < initialLength) {
        renderTable();
        updateCounts();
        alert('Aluno excluído com sucesso!');
      } else {
        alert('Erro: Aluno não encontrado para exclusão.');
      }
    }

    // --- Event Listeners e Inicialização ---
    document.getElementById("searchInput").addEventListener("input", renderTable);
    document.getElementById("turmaFilter").addEventListener("change", renderTable);
    document.getElementById("statusFilter").addEventListener("change", renderTable);

    document.addEventListener('DOMContentLoaded', () => {
      populateTurmaSelects();
      fetchAlunos(); // Carrega os alunos ao carregar a página
    });
  </script>
</body>

</html>